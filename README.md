# Foolproof

## 概要

Googleカレンダーの予定をもとに、指定した条件でアラームを鳴らすAndroidアプリです。うっかり忘れ（foolproof）を防ぐことを目的としています。

## 主な機能

* **カレンダー連携:**
    * デバイス内のカレンダーから予定を自動で読み取ります。
    * 設定画面で、アラームの対象としたいカレンダーを複数選択できます。

* **アラーム設定:**
    * 予定の開始時刻N分前にアラームをセットします（Nは設定で変更可能）。
    * 指定した時刻（例: 午前10時）より前の予定のみをアラーム対象にする、といった時刻制限が可能です。

* **高信頼なアラーム:**
    * フォアグラウンドサービスを利用し、アプリがタスクキルされてもアラームが鳴るように設計されています。
    * マナーモード（通知OFF）を貫通して音を鳴らします。
    * 端末の音量が小さくても、強制的にアラーム音量を最大にして再生します。
    * アラーム鳴動時にバイブレーションを作動させます。

* **バックグラウンド同期:**
    * `WorkManager` を利用し、約15分ごとにカレンダーの変更（追加・削除）を検知して、アラームを自動で再設定します。

## 技術概要・アーキテクチャ

* **言語:** Kotlin
* **UI:** Android Views (XML), ViewBinding
* **非同期処理:** Kotlin Coroutines
* **バックグラウンド処理:** WorkManager
* **アラーム:** AlarmManager, ForegroundService
* **データ永続化:**
    * Room: 鳴動済みアラームの履歴管理
    * SharedPreferences: ユーザー設定の保存
* **データソース:** ContentProvider (Android Calendar Provider)

## ビルド・実行方法

1.  本リポジトリをクローンします。
2.  Android Studioでプロジェクトを開きます。
3.  Gradleの同期が完了するのを待ちます。
4.  実機またはエミュレータを接続し、アプリを実行します。

### 初回起動後の必須設定
本アプリが正常に動作するには、以下の手動での権限許可が必要です。

1.  **各種権限の許可:**
    * アプリ起動時に表示されるダイアログで「カレンダー」「通知」の権限を許可してください。
2.  **正確なアラームの許可:**
    * アプリが自動で設定画面に誘導します。「アラームとリマインダー」の画面で、本アプリのスイッチをONにしてください。
3.  **バッテリー最適化の無効化:**
    * スマートフォンの `設定` > `アプリ` > `Foolproof` > `バッテリー` を開き、「制限なし」または「最適化しない」を選択してください。

## 今後の改修案 (TODO)

* [ ] スヌーズ（再通知）機能の実装
* [ ] アラーム音の選択機能
* [ ] 特定のキーワードを含む予定を除外するフィルター機能
* [ ] UI/UXの改善
* [ ] 古い鳴動履歴（データベース）を定期的に削除する処理の追加
* [ ] GoogleMAPとの連携機能。現在位置～目的地で移動時間を算出しアラーム時間を自動で調節する機能
